---
layout: page
title: Last 25 Travis builds
---
{% assign pages_list = site.pages | where: 'layout','test-result' %}

{% assign job_num_string_list = '' %}
{% for page in pages_list %}
  {% comment %} Make job number 8 symbols long, prepended with zeros {% endcomment %}
  {% assign travis_job_sortkey = page.travis.job-number | prepend: '00000000' | slice: -8, 8 %}

  {% comment %} Append actual job number after sortkey, with a ^ as separator {% endcomment %}
  {% assign job_num_string = travis_job_sortkey | append: '^' | append: page.travis.job-number %}

  {% comment %} Add to string list {% endcomment %}
  {% if job_num_string_list == '' %}
    {% assign job_num_string_list = job_num_string %}
  {% else %}
    {% assign job_num_string_list = job_num_string_list | append: ',' | append: job_num_string %}
  {% endif %}
{% endfor %}

{% comment %} Convert to a list, and sort in descending order {% endcomment %}
{% assign job_num_string_list = job_num_string_list | split: ',' | sort | reverse %}

<table class="test-overview">
  <thead>
    <tr>
      <th>Job</th>
      <th>Branch</th>
      <th>Commit</th>
      <th># passed</th>
    </tr>
  </thead>
  <tbody>
  {% for job_num_string in job_num_string_list limit:25 %}
    {% assign job_num_string_parts = job_num_string | split: '^' %}
    {% assign travis_job_number = job_num_string_parts[1] %}
    {% for page in pages_list %}
      {% capture page_job_num_str %}{{ page.travis.job-number }}{% endcapture %}
      {% if page_job_num_str == travis_job_number %}
        {% if page.travis.test-result == 0 %}
          {% assign passed = true %}
        {% else %}
          {% assign passed = false %}
        {% endif %}
        {% capture travis_job_data_name %}{{ page.travis.job-number | replace: '.', '_' }}{% endcapture %}
        {% assign result_map = site.data.travis-builds[travis_job_data_name] %}
        {% capture commit_hash %}{{ page.travis.commit }}{% endcapture %}
        <tr class="{% if passed %}passed{% else %}failed{% endif %}">
          <td><a href="{{ site.baseurl }}{{ page.url }}">#{{ page.travis.job-number }}</a></td>
          <td><a href="https://github.com/egraff/uit-thesis/tree/{{ page.travis.branch }}">{{ page.travis.branch }}</a></td>
          <td><a href="https://github.com/egraff/uit-thesis/commit/{{ commit_hash }}">{{ commit_hash | truncate: 9 }}</a></td>
          <td>
            {% unless result_map %}
              N/A
            {% else %}
              {{ result_map.num_tests | minus: result_map.failed_tests.size }}/{{ result_map.num_tests }}
            {% endunless %}
          </td>
        </tr>
      {% endif %}
    {% endfor %}
  {% endfor %}
  </tbody>
</table>
